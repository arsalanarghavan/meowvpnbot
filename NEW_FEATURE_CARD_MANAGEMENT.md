# ๐ ูุงุจูุช ุฌุฏุฏ: ุณุณุชู ูุฏุฑุช ููุดููุฏ ฺูุฏ ฺฉุงุฑุช ุจุงูฺฉ

## ๐ ุฎูุงุตู

ฺฉ ุณุณุชู ูพุดุฑูุชู ู ฺฉุงููุงู ุฎูุฏฺฉุงุฑ ุจุฑุง ูุฏุฑุช ฺูุฏ ุดูุงุฑู ฺฉุงุฑุช ุฏุฑ ูพุฑุฏุงุฎุช ฺฉุงุฑุช ุจู ฺฉุงุฑุช!

---

## โจ ูุงุจูุชโูุง

### ๐ณ ูุฏุฑุช ฺูุฏ ฺฉุงุฑุช
- ุงุถุงูู ฺฉุฑุฏู ฺฉุงุฑุชโูุง ุจุงูฺฉ ูุงูุญุฏูุฏ
- ูุฑุงุดุ ุญุฐูุ ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู
- ูุดุงูุฏู ุขูุงุฑ ูุญุธูโุง

### ๐ ุณูู ุฑูุฒุงูู
- ุชุนู ุญุฏุงฺฉุซุฑ ูุจูุบ ุฏุฑุงูุช ุฑูุฒุงูู ุจุฑุง ูุฑ ฺฉุงุฑุช
- ููุงุด ุฏุฑุงูุช ุงูุฑูุฒ
- ููุงุด ุธุฑูุช ุจุงููุงูุฏู
- ุฏุฑุตุฏ ุงุณุชูุงุฏู

### ๐ข ุงูููุชโุจูุฏ
- ุชุนู ุชุฑุชุจ ุงุณุชูุงุฏู ุงุฒ ฺฉุงุฑุชโูุง
- ุนุฏุฏ ฺฉูฺฺฉุชุฑ = ุงูููุช ุจุงูุงุชุฑ
- ุงูุชุฎุงุจ ุฎูุฏฺฉุงุฑ ุจุฑ ุงุณุงุณ ุงูููุช

### ๐ ุชุนูุถ ููุดููุฏ
- ููุช ุณูู ฺฉ ฺฉุงุฑุช ูพุฑ ุดุฏุ **ุฎูุฏฺฉุงุฑ** ุจู ฺฉุงุฑุช ุจุนุฏ ูโุฑูุฏ
- ุงูฺฏูุฑุชู ููุดููุฏ ุงูุชุฎุงุจ ฺฉุงุฑุช
- Fallback ุจู ุณุณุชู ูุฏู (settings)

### ๐ Reset ุฎูุฏฺฉุงุฑ
- ูุฑ ุดุจ ููู ุดุจ (00:01)
- ุตูุฑ ุดุฏู ุฎูุฏฺฉุงุฑ ูุจุงูุบ ุฑูุฒุงูู
- ุขูุงุฏู ุจุฑุง ุฑูุฒ ุฌุฏุฏ

---

## ๐ ูุงูโูุง ุงุฌุงุฏ ุดุฏู

### 1. Model:
```
database/models/card_account.py
```
**ุดุงูู:**
- ฺฉูุงุณ CardAccount
- ูุชุฏูุง has_capacity() ู remaining_capacity()

### 2. Queries:
```
database/models/queries/card_queries.py
```
**ุชูุงุจุน:**
- `create_card_account()` - ุงุฌุงุฏ ฺฉุงุฑุช ุฌุฏุฏ
- `get_all_cards()` - ูุณุช ฺฉุงุฑุชโูุง
- `get_available_card_for_amount()` - ุงูุชุฎุงุจ ููุดููุฏ ฺฉุงุฑุช
- `add_amount_to_card()` - ุงูุฒูุฏู ูุจูุบ
- `reset_daily_amounts()` - reset ุฑูุฒุงูู
- `update_card()` - ุจูโุฑูุฒุฑุณุงู
- `delete_card()` - ุญุฐู
- `toggle_card_status()` - ูุนุงู/ุบุฑูุนุงู
- `get_card_statistics()` - ุขูุงุฑ

### 3. Handler:
```
bot/handlers/admin/card_management.py
```
**Handler ูุง:**
- `list_card_accounts()` - ููุงุด ูุณุช
- `show_card_management_menu()` - ููู ูุฏุฑุช
- `start_add_card()` - ุดุฑูุน ุงูุฒูุฏู
- `toggle_card_status()` - ุชุบุฑ ูุถุนุช
- `delete_card_confirm()` - ุญุฐู ุจุง ุชุงุฏ
- Conversation handler ฺฉุงูู

### 4. Migration:
```
alembic/versions/003_add_card_accounts.py
```

### 5. Documentation:
```
CARD_MANAGEMENT_GUIDE.md
```
ุฑุงูููุง ฺฉุงูู 40+ ุฎุท!

---

## ๐ ูุงูโูุง ุจูโุฑูุฒุฑุณุงู ุดุฏู

1. โ `bot/handlers/customer/payment_handlers.py`
   - ุงูุชุฎุงุจ ุฎูุฏฺฉุงุฑ ฺฉุงุฑุช
   - Fallback ุจู ุณุณุชู ูุฏู
   
2. โ `bot/handlers/admin/financial_handlers.py`
   - ุจูโุฑูุฒุฑุณุงู current_amount ูพุณ ุงุฒ ุชุงุฏ ุฑุณุฏ
   
3. โ `bot/jobs.py`
   - ุงุถุงูู ุดุฏู `reset_card_daily_amounts()`
   
4. โ `main.py`
   - ุซุจุช handler ูุง
   - ุซุจุช job ุฑูุฒุงูู reset
   
5. โ `bot/states/conversation_states.py`
   - 8 state ุฌุฏุฏ
   
6. โ `bot/keyboards/reply_keyboards.py`
   - ุฏฺฉูู ูุฏุฑุช ฺฉุงุฑุชโูุง
   
7. โ `locales/fa.json`
   - 20+ ูุชู ูุงุฑุณ ุฌุฏุฏ

---

## ๐ฌ ูุชูโูุง ูุงุฑุณ ุฌุฏุฏ

### ูพุงูโูุง:
- admin_no_cards
- admin_add_first_card
- admin_cards_list_header
- admin_card_item
- admin_card_details
- admin_enter_card_number
- admin_enter_card_holder
- admin_enter_card_limit
- admin_enter_card_priority
- admin_enter_card_note_optional
- admin_confirm_card_creation
- admin_card_created_successfully
- admin_card_updated
- admin_card_deleted
- admin_card_activated
- admin_card_deactivated
- admin_confirm_card_deletion
- admin_enter_new_card_limit
- admin_enter_new_card_priority
- admin_enter_new_card_note
- admin_no_active_card
- error_invalid_card_number
- error_invalid_card_holder

### ุฏฺฉููโูุง:
- card_management (7 ุฏฺฉูู)

---

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุจุฑุง ุงุฏูู:

```
1. /admin
2. โ๏ธ ุชูุธูุงุช ุฑุจุงุช
3. ๐ณ ูุฏุฑุช ฺฉุงุฑุชโูุง
4. โ ุงูุฒูุฏู ฺฉุงุฑุช ุฌุฏุฏ
5. ูุงุฑุฏ ฺฉุฑุฏู ุงุทูุงุนุงุช:
   - ุดูุงุฑู ฺฉุงุฑุช: 6037997712345678
   - ูุงู: ุนู ูุญูุฏ
   - ุณูู ุฑูุฒุงูู: 50000000 (ุง 0 ุจุฑุง ูุงูุญุฏูุฏ)
   - ุงูููุช: 0 (ุนุฏุฏ ฺฉูฺฺฉุชุฑ = ุงูููุช ุจุงูุงุชุฑ)
   - ุงุฏุฏุงุดุช: ฺฉุงุฑุช ุงุตู
6. ุชุงุฏ
โ ฺฉุงุฑุช ุงุถุงูู ุดุฏ!
```

### ุจุฑุง ฺฉุงุฑุจุฑ (ุฎูุฏฺฉุงุฑ):

```
1. ุฎุฑุฏ ุณุฑูุณ ุง ุดุงุฑฺ ฺฉู ูพูู
2. ุงูุชุฎุงุจ ูพุฑุฏุงุฎุช ฺฉุงุฑุช ุจู ฺฉุงุฑุช
3. ุณุณุชู ุฎูุฏฺฉุงุฑ ฺฉุงุฑุช ููุงุณุจ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ:
   - ุจุง ุจุงูุงุชุฑู ุงูููุช
   - ฺฉู ุธุฑูุช ฺฉุงู ุฏุงุฑุฏ
4. ุดูุงุฑู ฺฉุงุฑุช ููุงุด ุฏุงุฏู ูโุดูุฏ
5. ฺฉุงุฑุจุฑ ูุงุฑุฒ ูโฺฉูุฏ
6. ูพุณ ุงุฒ ุชุงุฏ ุงุฏูู:
   - ูุจูุบ ุจู current_amount ฺฉุงุฑุช ุงุถุงูู ูโุดูุฏ
```

---

## ๐ฏ ูุซุงู ุนูู

### ูพฺฉุฑุจูุฏ:

```python
# ฺฉุงุฑุช 1
card_number: "6037997712345678"
card_holder: "ุนู ูุญูุฏ"
daily_limit: 50_000_000  # ูพูุฌุงู ูููู
priority: 0
current_amount: 35_000_000  # ุณ ู ูพูุฌ ูููู ุฏุฑุงูุช ุดุฏู
remaining: 15_000_000  # ูพุงูุฒุฏู ูููู ุจุงููุงูุฏู

# ฺฉุงุฑุช 2
card_number: "6219991234567890"
card_holder: "ุฑุถุง ุงุญูุฏ"  
daily_limit: 0  # ูุงูุญุฏูุฏ
priority: 1
current_amount: 20_000_000
remaining: โ  # ูุงูุญุฏูุฏ
```

### ุณูุงุฑู:

```
ฺฉุงุฑุจุฑ A ูโุฎูุงูุฏ 10 ูููู ูุงุฑุฒ ฺฉูุฏ:
โ ฺฉุงุฑุช 1 ุธุฑูุช ุฏุงุฑุฏ (15M ุจุงููุงูุฏู)
โ ฺฉุงุฑุช 1 ุงูุชุฎุงุจ ูโุดูุฏ โ

ฺฉุงุฑุจุฑ B ูโุฎูุงูุฏ 20 ูููู ูุงุฑุฒ ฺฉูุฏ:
โ ฺฉุงุฑุช 1 ุธุฑูุช ูุฏุงุฑุฏ (ููุท 5M ุจุงููุงูุฏู)
โ ฺฉุงุฑุช 2 ุงูุชุฎุงุจ ูโุดูุฏ โ

ูพุณ ุงุฒ ุชุงุฏ ูุงุฑุฒ ฺฉุงุฑุจุฑ A:
โ current_amount ฺฉุงุฑุช 1 = 45M
โ remaining ฺฉุงุฑุช 1 = 5M

ูพุณ ุงุฒ ุชุงุฏ ูุงุฑุฒ ฺฉุงุฑุจุฑ B:
โ current_amount ฺฉุงุฑุช 2 = 40M
```

---

## ๐ ูุฒุงุง

### โ ุฌููฺฏุฑ ุงุฒ ูุณุฏูุฏุณุงุฒ
ุจุงูฺฉโูุง ูุนูููุงู ฺฉุงุฑุชโูุง ุฑุง ฺฉู ูุจูุบ ุฒุงุฏ ุฏุฑ ฺฉ ุฑูุฒ ุฏุฑุงูุช ูโฺฉููุฏุ ูุณุฏูุฏ ูโฺฉููุฏ. ุจุง ุงู ุณุณุชู:
- ูุจูุบ ุจู ฺูุฏ ฺฉุงุฑุช ุชูุฒุน ูโุดูุฏ
- ูฺ ฺฉุงุฑุช ุจุด ุงุฒ ุญุฏ ูุดุฎุต ูพูู ุฏุฑุงูุช ููโฺฉูุฏ

### โ ูุฏุฑุช ุขุณุงู
- ุฏฺฏุฑ ูุงุฒ ุจู ุชุบุฑ ุฏุณุช ุดูุงุฑู ฺฉุงุฑุช ูุณุช
- ุณุณุชู ุฎูุฏฺฉุงุฑ ฺฉุงุฑุช ููุงุณุจ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ

### โ ุงูุฒุงุด ุธุฑูุช
- ุจุง N ฺฉุงุฑุชุ ูโุชูุงูุฏ N ุจุฑุงุจุฑ ุจุดุชุฑ ุฏุฑุงูุช ฺฉูุฏ
- ูุซุงู: 3 ฺฉุงุฑุช ุจุง ุณูู 50M = 150M ุธุฑูุช ุฑูุฒุงูู

### โ ุงูุนุทุงูโูพุฐุฑ
- ุชูุธูุงุช ฺฉุงูู ุจุฑุง ูุฑ ฺฉุงุฑุช
- ุงูููุชโุจูุฏ ุจุฑ ุงุณุงุณ ูุงุฒ
- ูุนุงู/ุบุฑูุนุงู ูููุช

---

## ๐ง ุชูุธูุงุช ูพุดููุงุฏ

### ุจุฑุง ูุฑูุด ุฑูุฒุงูู ุชุง 100 ูููู:

```
ฺฉุงุฑุช 1: ุณูู 50Mุ ุงูููุช 0
ฺฉุงุฑุช 2: ุณูู 50Mุ ุงูููุช 1
ฺฉุงุฑุช ูพุดุชุจุงู: ูุงูุญุฏูุฏุ ุงูููุช 2
```

### ุจุฑุง ูุฑูุด ุฑูุฒุงูู ุชุง 200 ูููู:

```
ฺฉุงุฑุช 1: ุณูู 50Mุ ุงูููุช 0
ฺฉุงุฑุช 2: ุณูู 50Mุ ุงูููุช 1  
ฺฉุงุฑุช 3: ุณูู 50Mุ ุงูููุช 2
ฺฉุงุฑุช 4: ุณูู 50Mุ ุงูููุช 3
ฺฉุงุฑุช ูพุดุชุจุงู: ูุงูุญุฏูุฏุ ุงูููุช 4
```

---

<div align="center">

## ๐ ุชุจุฑฺฉ!

**ุดูุง ุงูุงู ฺฉ ุณุณุชู ูุฏุฑุช ฺฉุงุฑุช ุญุฑููโุง ุฏุงุฑุฏ!**

ุงู ูุงุจูุช ุดูุง ุฑุง ุงุฒ 99% ุฑุจุงุชโูุง VPN ูุชูุงุฒ ูโฺฉูุฏ! ๐

---

**ุฑุงูููุง ฺฉุงูู:** [CARD_MANAGEMENT_GUIDE.md](CARD_MANAGEMENT_GUIDE.md)

</div>

