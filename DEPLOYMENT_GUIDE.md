# ๐ ุฑุงูููุง ุงุณุชูุฑุงุฑ ฺฉุงูู ุฑุจุงุช VPN

## ๐ ูพุดโูุงุฒูุง

### ูุฑูโุงูุฒุงุฑูุง:
- Python 3.9 ุง ุจุงูุงุชุฑ
- PostgreSQL ุง SQLite
- ฺฉ ุณุฑูุฑ ูููฺฉุณ (Ubuntu/Debian ุชูุตู ูโุดูุฏ)
- ฺฉ ูพูู Marzban ูุนุงู ู ุฏุฑ ุฏุณุชุฑุณ

### ุงุทูุงุนุงุช ููุฑุฏ ูุงุฒ:
- ุชูฺฉู ุฑุจุงุช ุชูฺฏุฑุงู (ุงุฒ @BotFather)
- ุขุฏ ุนุฏุฏ ุงุฏูู(ูุง)
- ุงุทูุงุนุงุช ุงุชุตุงู ุจู ูพูู Marzban
- (ุงุฎุชุงุฑ) ฺฉุฏ ูุฑฺูุช ุฒุฑูโูพุงู
- (ุงุฎุชุงุฑ) ุขุฏ ฺฉุงูุงู ูุงฺฏ

## ๐ฅ ูุตุจ

### 1. ฺฉููู ูพุฑูฺู
```bash
cd /mnt/1AF200F7F200D941/Projects/Bots
git clone <repository-url> meowvpnbot
cd meowvpnbot
```

### 2. ูุตุจ Dependencies
```bash
pip install -r requirements.txt
```

ุง ุจุง virtual environment:
```bash
python -m venv venv
source venv/bin/activate  # ุฏุฑ ูููฺฉุณ/ูฺฉ
# ุง
venv\Scripts\activate  # ุฏุฑ ููุฏูุฒ

pip install -r requirements.txt
```

### 3. ุชูุธู ูุงู .env

ูุงู `.env` ุฑุง ุฏุฑ ุฑุดู ูพุฑูฺู ุงุฌุงุฏ ฺฉูุฏ:

```env
# === Telegram Bot Configuration ===
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_USERNAME=YourBotUsername

# === Admin IDs (ุจุง ฺฉุงูุง ุฌุฏุง ุดููุฏ) ===
ADMIN_ID=123456789,987654321

# === Database ===
# ุจุฑุง SQLite (ุชูุณุนู):
DATABASE_URL=sqlite:///./meowvpn.db

# ุง ุจุฑุง PostgreSQL (ูพุฑูุฏุงฺฉุดู):
# DATABASE_URL=postgresql://user:password@localhost/dbname

# === Logging ===
LOG_CHANNEL_ID=-1001234567890

# === Payment Gateway ===
ZARINPAL_MERCHANT_ID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

# === Optional ===
CHANNEL_LOCK_ID=@YourChannelUsername
```

### 4. ุงุฌุฑุง Migration ูุง

```bash
# ุงุฌุงุฏ ุงููู migration (ุงฺฏุฑ ูุฌูุฏ ูุฏุงุฑุฏ)
alembic revision --autogenerate -m "Initial migration"

# ุงุฌุฑุง ุชูุงู migration ูุง
alembic upgrade head
```

## โ๏ธ ุชูุธูุงุช ุงููู

### 1. ุงุถุงูู ฺฉุฑุฏู ูพูู Marzban

ูพุณ ุงุฒ ุงุฌุฑุง ุฑุจุงุชุ ุงุฒ ูพูู ุงุฏูู:
1. ูุงุฑุฏ ยซุชูุธูุงุช ุฑุจุงุชยป ุดูุฏ
2. ยซูุฏุฑุช ูพููโูุงยป ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ยซุงูุฒูุฏู ูพูู ุฌุฏุฏยป ุฑุง ุจุฒูุฏ
4. ุงุทูุงุนุงุช ูพูู ุฑุง ูุงุฑุฏ ฺฉูุฏ:
   - ูุงู: ฺฉ ูุงู ุชูุตู (ูุซูุงู "ูพูู ุงุตู")
   - URL: ุขุฏุฑุณ ฺฉุงูู ูพูู (https://panel.example.com)
   - ูุงู ฺฉุงุฑุจุฑ: username ุงุฏูู ูพูู
   - ุฑูุฒ ุนุจูุฑ: password ุงุฏูู ูพูู

### 2. ุงุฌุงุฏ ูพููโูุง

ุงุฒ ูพูู ุงุฏูู:
1. ยซุชูุธูุงุช ุฑุจุงุชยป โ ยซูุฏุฑุช ูพููโูุงยป
2. ยซุงูุฒูุฏู ูพูู ุฌุฏุฏยป
3. ูุดุฎุตุงุช ูพูู ุฑุง ูุงุฑุฏ ฺฉูุฏ:
   - ูุงู
   - ุฏุณุชูโุจูุฏ (ุนุงุฏุ ูฺูุ ฺฏููฺฏุ ุชุฑุฏ)
   - ูุฏุช ุฒูุงู (ุฑูุฒ)
   - ุญุฌู (ฺฏฺฏุงุจุงุช) - 0 ุจุฑุง ูุงูุญุฏูุฏ
   - ููุช (ุชููุงู)
   - ุชุนุฏุงุฏ ฺฉุงุฑุจุฑ ููุฒูุงู

### 3. ุชูุธูุงุช ูพุฑุฏุงุฎุช

ุงุฒ ูพูู ุงุฏูู:
1. ยซุชูุธูุงุช ุฑุจุงุชยป โ ยซุชูุธูุงุช ูพุฑุฏุงุฎุชยป
2. ูุงุฑุฏ ฺฉุฑุฏู:
   - ุดูุงุฑู ฺฉุงุฑุช (ุจุฑุง ฺฉุงุฑุช ุจู ฺฉุงุฑุช)
   - ูุงู ุตุงุญุจ ุญุณุงุจ
   - ฺฉุฏ ูุฑฺูุช ุฒุฑูโูพุงู (ุงุฎุชุงุฑ)

### 4. ุชูุธูุงุช ฺฉูุณูู

ุจุฑุง ูุนุงูโุณุงุฒ ุณุณุชู ุจุงุฒุงุฑุงุจ:
1. ยซุชูุธูุงุช ุฑุจุงุชยป โ ยซุชูุธูุงุช ฺฉูุณููยป
2. ุงูุฒูุฏู ูพูฺฉุงูโูุง ฺฉูุณูู:
   - ูุซุงู: ุงุฒ 0 ฺฉุงุฑุจุฑ โ 5%
   - ุงุฒ 10 ฺฉุงุฑุจุฑ โ 7%
   - ุงุฒ 50 ฺฉุงุฑุจุฑ โ 10%

## ๐ ุงุฌุฑุง ุฑุจุงุช

### ุญุงูุช ุชูุณุนู:
```bash
python main.py
```

### ุญุงูุช ูพุฑูุฏุงฺฉุดู (ุจุง systemd):

#### ุงุฌุงุฏ ูุงู service:
```bash
sudo nano /etc/systemd/system/meowvpnbot.service
```

ูุญุชูุง ูุงู:
```ini
[Unit]
Description=MeowVPN Telegram Bot
After=network.target

[Service]
Type=simple
User=your_username
WorkingDirectory=/mnt/1AF200F7F200D941/Projects/Bots/meowvpnbot
Environment="PATH=/home/your_username/venv/bin"
ExecStart=/home/your_username/venv/bin/python main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### ูุนุงูโุณุงุฒ ู ุงุฌุฑุง:
```bash
sudo systemctl daemon-reload
sudo systemctl enable meowvpnbot
sudo systemctl start meowvpnbot

# ุจุฑุฑุณ ูุถุนุช:
sudo systemctl status meowvpnbot

# ูุดุงูุฏู ูุงฺฏโูุง:
sudo journalctl -u meowvpnbot -f
```

## ๐งช ุชุณุช ุฑุจุงุช

### 1. ุชุณุชโูุง ุงููู:
- [ ] ุงุฑุณุงู `/start` ู ุจุฑุฑุณ ููู ุงุตู
- [ ] ุจุฑุฑุณ ุฏฺฉูู ยซุงุทูุงุนุงุช ุญุณุงุจยป
- [ ] ุจุฑุฑุณ ยซฺฉู ูพููยป
- [ ] ุชุณุช ยซุงฺฉุงูุช ุชุณุชยป (ุงฺฏุฑ ูุนุงู ุจุงุดุฏ)

### 2. ุชุณุช ุฎุฑุฏ:
- [ ] ุงูุชุฎุงุจ ุฏุณุชูโุจูุฏ ุณุฑูุณ
- [ ] ุงูุชุฎุงุจ ูพูู
- [ ] ุชุงุฏ ุฎุฑุฏ
- [ ] ุชุณุช ูพุฑุฏุงุฎุช ุงุฒ ฺฉู ูพูู
- [ ] ุชุณุช ฺฉุงุฑุช ุจู ฺฉุงุฑุช
- [ ] ุฏุฑุงูุช ููฺฉ ุงุดุชุฑุงฺฉ

### 3. ุชุณุช ูพูู ุงุฏูู:
- [ ] ูุฑูุฏ ุจุง `/admin`
- [ ] ุจุฑุฑุณ ุฏุงุดุจูุฑุฏ
- [ ] ุฌุณุชุฌู ฺฉุงุฑุจุฑ
- [ ] ุชุงุฏ ุฑุณุฏ
- [ ] ุงุฌุงุฏ ูพูู ุฌุฏุฏ
- [ ] ูพุงู ููฺฏุงู

### 4. ุชุณุช ุจุงุฒุงุฑุงุจ:
- [ ] ุชุจุฏู ุจู ุจุงุฒุงุฑุงุจ ุงุฒ ุฏฺฉูู ยซฺฉุณุจ ุฏุฑุขูุฏยป
- [ ] ุฏุฑุงูุช ููฺฉ ุฏุนูุช
- [ ] ุซุจุชโูุงู ฺฉุงุฑุจุฑ ุฌุฏุฏ ุจุง ููฺฉ ุฑูุฑุงู
- [ ] ุจุฑุฑุณ ฺฉูุณูู ูพุณ ุงุฒ ุฎุฑุฏ
- [ ] ุฏุฑุฎูุงุณุช ุชุณูู ุญุณุงุจ

## ๐ง ุฑูุน ูุดฺฉูุงุช ุฑุงุฌ

### ูุดฺฉู: ุฑุจุงุช ูพุงุณุฎ ููโุฏูุฏ
**ุฑุงู ุญู:**
1. ุชูฺฉู ุฑุจุงุช ุฑุง ฺฺฉ ฺฉูุฏ
2. ุงุชุตุงู ุงูุชุฑูุช ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ูุงฺฏโูุง ุฑุจุงุช ุฑุง ูุดุงูุฏู ฺฉูุฏ
4. ูุทูุฆู ุดูุฏ ูพูุฑุชโูุง ุฎุฑูุฌ ุจุงุฒ ูุณุชูุฏ

### ูุดฺฉู: ุฎุทุง ุฏุฑ ุงุชุตุงู ุจู ูพูู
**ุฑุงู ุญู:**
1. URL ูพูู ุฑุง ุจุฑุฑุณ ฺฉูุฏ (ุจุงุฏ https ุจุงุดุฏ)
2. ูุงู ฺฉุงุฑุจุฑ ู ุฑูุฒ ุนุจูุฑ ุฑุง ฺฺฉ ฺฉูุฏ
3. ูุทูุฆู ุดูุฏ ูพูู Marzban ุฏุฑ ุฏุณุชุฑุณ ุงุณุช
4. ูุงุฑูุงู ุณุฑูุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ

### ูุดฺฉู: Migration ุงุฌุฑุง ููโุดูุฏ
**ุฑุงู ุญู:**
```bash
# ูพุงฺฉ ฺฉุฑุฏู ุชุงุฑุฎฺู migration (ููุท ุฏุฑ ุชูุณุนู)
alembic downgrade base
alembic upgrade head

# ุง ุงุฌุงุฏ migration ุฌุฏุฏ
alembic revision --autogenerate -m "your message"
alembic upgrade head
```

### ูุดฺฉู: ูพุฑุฏุงุฎุช ุขููุงู ฺฉุงุฑ ููโฺฉูุฏ
**ุฑุงู ุญู:**
1. ฺฉุฏ ูุฑฺูุช ุฒุฑูโูพุงู ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ูุทูุฆู ุดูุฏ ุณุฑูุฑ ุจู ุฏุฑฺฏุงู ุฏุณุชุฑุณ ุฏุงุฑุฏ
3. callback URL ุฑุจุงุช ุฑุง ฺฺฉ ฺฉูุฏ

## ๐ Monitoring ู ูฺฏูุฏุงุฑ

### ูุงฺฏโูุง:
```bash
# ูุดุงูุฏู ูุงฺฏโูุง ุฑุจุงุช
tail -f /path/to/bot.log

# ุง ุจุง systemd
sudo journalctl -u meowvpnbot -f --lines=100
```

### ูพุดุชุจุงูโฺฏุฑ:

#### ูพุดุชุจุงูโฺฏุฑ ุฏุณุช:
```bash
# ุจุฑุง SQLite
cp meowvpn.db meowvpn_backup_$(date +%Y%m%d).db

# ุจุฑุง PostgreSQL
pg_dump dbname > backup_$(date +%Y%m%d).sql
```

#### ูพุดุชุจุงูโฺฏุฑ ุฎูุฏฺฉุงุฑ:
ุงุฒ ูพูู ุงุฏูู ุฑุจุงุชุ ุฏฺฉูู ยซูพุดุชุจุงูโฺฏุฑยป ุฑุง ุจุฒูุฏ.

### Job ูุง ุฎูุฏฺฉุงุฑ:

ุฑุจุงุช ุฏุงุฑุง 2 job ุฎูุฏฺฉุงุฑ ุงุณุช:

1. **Auto-renewal (ุณุงุนุช 1 ุตุจุญ):**
   - ุจุฑุฑุณ ุณุฑูุณโูุง ฺฉู ุชูุฏุฏ ุฎูุฏฺฉุงุฑ ุฏุงุฑูุฏ
   - ุชูุฏุฏ ุฏุฑ ุตูุฑุช ููุฌูุฏ ฺฉุงู

2. **Notifications (ุณุงุนุช 9 ุตุจุญ):**
   - ุจุฑุฑุณ ุณุฑูุณโูุง ุฏุฑ ุญุงู ุงููุถุง
   - ุจุฑุฑุณ ุณุฑูุณโูุง ุจุง ุญุฌู ฺฉู
   - ุงุฑุณุงู ููุชูฺฉุดู ุจู ฺฉุงุฑุจุฑุงู

## ๐ ุงููุช

### ุชูุตูโูุง ุงููุช:

1. **ูุงู .env ุฑุง ูุญุงูุธุช ฺฉูุฏ:**
```bash
chmod 600 .env
```

2. **ุงุฒ HTTPS ุงุณุชูุงุฏู ฺฉูุฏ:**
   - ุจุฑุง ูพูู Marzban
   - ุจุฑุง ฺฉุงูโุจฺฉ ูพุฑุฏุงุฎุช

3. **Firewall ุฑุง ุชูุธู ฺฉูุฏ:**
```bash
# ููุท ูพูุฑุชโูุง ุถุฑูุฑ ุฑุง ุจุงุฒ ฺฉูุฏ
ufw allow 22/tcp
ufw allow 443/tcp
ufw enable
```

4. **ุจูโุฑูุฒุฑุณุงู ููุธู:**
```bash
# ุจูโุฑูุฒุฑุณุงู ูพฺฉุฌโูุง
pip install --upgrade -r requirements.txt

# ุจูโุฑูุฒุฑุณุงู ุณุณุชู
sudo apt update && sudo apt upgrade -y
```

5. **ูพุดุชุจุงูโฺฏุฑ ููุธู:**
   - ุญุฏุงูู ููุชูโุง ฺฉุจุงุฑ
   - ุฐุฎุฑู ุฏุฑ ูฺฉุงู ุงูู (ุฎุงุฑุฌ ุงุฒ ุณุฑูุฑ)

## ๐ฏ ุจูููโุณุงุฒ

### ุจุฑุง ุญุฌู ฺฉุงุฑุจุฑ ุจุงูุง:

1. **ุงุณุชูุงุฏู ุงุฒ PostgreSQL ุจู ุฌุง SQLite**

2. **ูุนุงูโุณุงุฒ Connection Pooling:**
ุฏุฑ `database/engine.py`:
```python
engine = create_engine(
    DATABASE_URL,
    pool_size=20,
    max_overflow=40,
    pool_pre_ping=True
)
```

3. **ุงุณุชูุงุฏู ุงุฒ Redis ุจุฑุง Cache:**
(ูุงุจูุช ุขูุฏู - ุฏุฑ ูุณุฎูโูุง ุจุนุฏ)

4. **ุงูุฒุงุด ุชุนุฏุงุฏ Worker ูุง:**
ุฏุฑ `main.py`:
```python
application = ApplicationBuilder()\
    .token(BOT_TOKEN)\
    .concurrent_updates(True)\
    .build()
```

## ๐ฑ ุงุณุชูุงุฏู ุงุฒ ุฑุจุงุช

### ุจุฑุง ูุดุชุฑุงู:
1. ุดุฑูุน ุจุง `/start`
2. ุฎุฑุฏ ุณุฑูุณ ุงุฒ ููู ยซ๐๏ธ ุฎุฑุฏ ุณุฑูุณยป
3. ูุฏุฑุช ุณุฑูุณโูุง ุงุฒ ยซ๐ง ูุฏุฑุช ุณุฑูุณยป
4. ุดุงุฑฺ ฺฉู ูพูู ุงุฒ ยซ๐ฐ ฺฉู ูพููยป
5. ฺฉุณุจ ุฏุฑุขูุฏ ุงุฒ ยซ๐ต ฺฉุณุจ ุฏุฑุขูุฏยป

### ุจุฑุง ุจุงุฒุงุฑุงุจโูุง:
1. ุชุจุฏู ุจู ุจุงุฒุงุฑุงุจ ุงุฒ ยซ๐ต ฺฉุณุจ ุฏุฑุขูุฏยป
2. ุฏุฑุงูุช ููฺฉ ุฏุนูุช ุงุฒ ยซ๐ ูพูู ุจุงุฒุงุฑุงุจยป
3. ุจู ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ููฺฉ
4. ุฏุฑุงูุช ฺฉูุณูู ุงุฒ ูุฑ ุฎุฑุฏ
5. ุฏุฑุฎูุงุณุช ุชุณูู ุญุณุงุจ

### ุจุฑุง ุงุฏููโูุง:
1. ูุฑูุฏ ุจู ูพูู ุจุง `/admin`
2. ูุดุงูุฏู ุฏุงุดุจูุฑุฏ
3. ูุฏุฑุช ฺฉุงุฑุจุฑุงู
4. ุชุงุฏ ุฑุณุฏูุง
5. ุชูุธูุงุช ุฑุจุงุช (ูพููโูุงุ ูพููโูุงุ ูุชูโูุง)
6. ูพุงู ููฺฏุงู
7. ูพุดุชุจุงูโฺฏุฑ

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:

### 1. ุจุฑุฑุณ ูุงฺฏโูุง:
```bash
# ูุงฺฏ ุณุณุชู
sudo journalctl -u meowvpnbot -n 100

# ูุงฺฏ ฺฉุงูุงู ุชูฺฏุฑุงู
# ุงฺฏุฑ LOG_CHANNEL_ID ุชูุธู ฺฉุฑุฏู ุจุงุดุฏุ ุฎุทุงูุง ุฏุฑ ฺฉุงูุงู ุงุฑุณุงู ูโุดููุฏ
```

### 2. ุฏุจุงฺฏ:
```bash
# ุงุฌุฑุง ุจุง verbose logging
python main.py
```

### 3. ูุดฺฉูุงุช ุฑุงุฌ:

| ูุดฺฉู | ุฑุงู ุญู |
|------|--------|
| ุฑุจุงุช ุงุณุชุงุฑุช ููโุฎูุฑุฏ | ุชูฺฉู ู .env ุฑุง ฺฺฉ ฺฉูุฏ |
| ูพูู ูุชุตู ููุดู | URLุ usernameุ password ุฑุง ุจุฑุฑุณ ฺฉูุฏ |
| ูพุฑุฏุงุฎุช ฺฉุงุฑ ููโฺฉูุฏ | ฺฉุฏ ูุฑฺูุช ู ุชูุธูุงุช ุฑุง ฺฺฉ ฺฉูุฏ |
| ููุชูฺฉุดู ุงุฑุณุงู ููุดู | job_queue ูุนุงู ุจุงุดุฏ ู ฺฉุงุฑุจุฑ ุฑุจุงุช ุฑุง ุจูุงฺฉ ูฺฉุฑุฏู ุจุงุดุฏ |
| Migration ุฎุทุง ูุฏู | `alembic downgrade base` ู ุฏูุจุงุฑู `upgrade head` |

## ๐ ุจูโุฑูุฒุฑุณุงู

ุจุฑุง ุจูโุฑูุฒุฑุณุงู ุฑุจุงุช:

```bash
# 1. ุชููู ุฑุจุงุช
sudo systemctl stop meowvpnbot

# 2. ูพุดุชุจุงูโฺฏุฑ
cp meowvpn.db meowvpn_backup.db

# 3. ุฏุฑุงูุช ุขุฎุฑู ูุณุฎู
git pull origin main

# 4. ุจูโุฑูุฒุฑุณุงู dependencies
pip install --upgrade -r requirements.txt

# 5. ุงุฌุฑุง migration ูุง ุฌุฏุฏ
alembic upgrade head

# 6. ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ
sudo systemctl start meowvpnbot
```

## ๐ ูฺฉุงุช ุจูููโุณุงุฒ ุนููฺฉุฑุฏ

### 1. Database Optimization:
```sql
-- ุงุฌุงุฏ ุงูุฏฺฉุณโูุง ููุฏ
CREATE INDEX idx_services_user_id ON services(user_id);
CREATE INDEX idx_services_expire_date ON services(expire_date);
CREATE INDEX idx_transactions_user_id ON transactions(user_id);
CREATE INDEX idx_transactions_status ON transactions(status);
```

### 2. Cron Jobs:
ุงุถุงูู ฺฉุฑุฏู backup ุฎูุฏฺฉุงุฑ ุฑูุฒุงูู:
```bash
crontab -e

# ุงุถุงูู ฺฉุฑุฏู ุฎุท ุฒุฑ:
0 3 * * * cp /path/to/meowvpn.db /path/to/backups/meowvpn_$(date +\%Y\%m\%d).db
```

### 3. Log Rotation:
```bash
sudo nano /etc/logrotate.d/meowvpnbot

# ูุญุชูุง:
/var/log/meowvpnbot/*.log {
    daily
    rotate 7
    compress
    delaycompress
    notifempty
    create 0640 your_user your_user
}
```

## ๐ ุชุจุฑฺฉ!

ุฑุจุงุช ุดูุง ุขูุงุฏู ุงุณุช! ุงฺฉููู ุฏุงุฑุง:

โ ุณุณุชู ุฎุฑุฏ ฺูุฏ ุฑูุด
โ ูุฏุฑุช ฺูุฏ ูพูู
โ ุณุณุชู ุจุงุฒุงุฑุงุจ
โ ููุชูฺฉุดูโูุง ููุดููุฏ
โ ุฏุงุดุจูุฑุฏ ูพุดุฑูุชู
โ FAQ ุฌุงูุน
โ ู ุจุด ุงุฒ 20 ูุงุจูุช ุฏฺฏุฑ!

**ูููู ุจุงุดุฏ! ๐**

---

ูุณุฎู: 2.5.0 | ุชุงุฑุฎ: 2025-10-16

